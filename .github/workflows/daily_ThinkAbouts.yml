name: 'üóìÔ∏è Ïò§ÎäòÏùò 1ÏãúÍ∞Ñ Í≥µÎ∂Ä Ï£ºÏ†ú ÏÉùÏÑ±'

on:
  # ÌïúÍµ≠ ÏãúÍ∞Ñ(KST) Í∏∞Ï§Ä Ïõî~Í∏à ÏûêÏ†ïÏóê Ïã§Ìñâ (UTC 15:00)
  schedule:
    - cron: '0 15 * * 1-5'

jobs:
  create_daily_study:
    name: Create Daily Study Issue
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: 'Set KST Timezone'
        uses: szenius/set-timezone@v2.0
        with:
          timezoneLinux: 'Asia/Seoul'
      
      - name: 'Generate Issue Content'
        id: issue_content
        run: |
          # üìö Í≥µÎ∂ÄÌï† Ï£ºÏ†ú Î∞∞Ïó¥ (Ï†ÑÎã¨Î∞õÏùÄ 90+Í∞ú Ï£ºÏ†ú)
          TOPICS=(
            "SOP & CORS" "JWT" "OAuth" "ÎåÄÏπ≠ÌÇ§ vs ÎπÑÎåÄÏπ≠ÌÇ§" "XSS" "Ïù∏Ï¶ù(Authentication) vs Ïù∏Í∞Ä(Authorization)"
            "Ìä∏ÎûúÏû≠ÏÖòÍ≥º ACID" "Ï†ïÍ∑úÌôî(Normalization)" "Ïù∏Îç±Ïä§ (Clustered vs Non-clustered)" "MySQLÏùò Ïã§ÌñâÍ≥ÑÌöç"
            "InnoDB Ïä§ÌÜ†Î¶¨ÏßÄ ÏóîÏßÑ" "DB Lock (Optimistic vs Pessimistic)" "NoSQL" "JOINÏùò Ï¢ÖÎ•òÏôÄ ÏõêÎ¶¨" "Replication"
            "B-TreeÏôÄ B+Tree (Index)" "Connection Pool" "Trigger" "Covering Index" "Caching Strategy"
            "Bulk Insert" "Sequence" "Self Relationship"
            "IOC (Inversion of Control)" "AOP (Aspect Oriented Programming)" "PSA (Portable Service Abstraction)"
            "Spring MVC Íµ¨Ï°∞" "ÎÇ¥Ïû• Tomcat" "Servlet" "Spring Data JDBC" "JPA Persistent Context (ÏòÅÏÜçÏÑ± Ïª®ÌÖçÏä§Ìä∏)"
            "QueryDSL" "Jackson ÎùºÏù¥Î∏åÎü¨Î¶¨" "Spring Bean ÏÉùÎ™ÖÏ£ºÍ∏∞" "Spring Security Íµ¨Ï°∞" "Annotation Processor"
            "Profile (@Profile)" "Auto Configure (ÏûêÎèô ÏÑ§Ï†ï)" "Logger (SLF4J/Logback)" "Actuator" "WebClient"
            "WebFlux" "Jigsaw (Java Module System)" "Server Sent Event (SSE)" "Flyway (DB ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò)"
            "@Transactional ÎèôÏûë ÏõêÎ¶¨" "JUnit ÌÖåÏä§Ìä∏" "ÎèôÍ∏∞(Synchronous) vs ÎπÑÎèôÍ∏∞(Asynchronous)" "Spring Cloud"
            "Spring ÏòàÏô∏Ï≤òÎ¶¨ (ExceptionHandler)" "Redis ÌôúÏö©" "Dynamic Proxy vs CGLIB" "Web Polling (Long/Short)"
            "Filter vs Interceptor" "Í∏∞Î≥∏ÌÇ§ ÏÉùÏÑ± Ï†ÑÎûµ (Identity/Sequence/Table)" "Swagger (SpringDoc)"
            "javacÏôÄ Ïª¥ÌååÏùº Í≥ºÏ†ï" "Ï†ëÍ∑º Ï†úÏñ¥Ïûê(Access Modifier)Ïùò ÎèôÏûë Î∞©Ïãù" "GC (Garbage Collection) ÏïåÍ≥†Î¶¨Ï¶ò" "null Ï≤òÎ¶¨"
            "String, hashCode(), equals()" "Immutability (Î∂àÎ≥ÄÏÑ±)" "Serialization (ÏßÅÎ†¨Ìôî)" "JCF (Java Collections Framework)"
            "Java ÏòàÏô∏ Ï≤òÎ¶¨ Í≥ÑÏ∏µ (Checked vs Unchecked)" "Î©ÄÌã∞Ïä§Î†àÎìúÏôÄ Ïä§Î†àÎìúÌíÄ" "JVM Î©îÎ™®Î¶¨ Íµ¨Ï°∞ (Stack, Heap, Method)"
            "Java Stream API" "Optional ÌôúÏö©" "Functional Interface" "Lambda Expression" "Regular Expression (Ï†ïÍ∑úÌëúÌòÑÏãù)"
            "Process vs Thread" "Build Tool (Gradle vs Maven)" "Thread Safe ÏûêÎ£åÍµ¨Ï°∞ (ConcurrentHashMap Îì±)"
            "Map Íµ¨ÌòÑÏ≤¥ ÎπÑÍµê (HashMap, TreeMap, LinkedHashMap)" "Comparable vs Comparator" "Runnable vs Callable"
            "Cache Locality" "ÏñïÏùÄ Î≥µÏÇ¨ vs ÍπäÏùÄ Î≥µÏÇ¨" "Reflection API" "Java Î≤ÑÏ†ÑÎ≥Ñ ÌäπÏßï (8, 11, 17, 21)" "Generic"
            "static ÌÇ§ÏõåÎìú" "final ÌÇ§ÏõåÎìú" "Java Record (Java 14+)" "JMX (Java Management Extensions)"
            "Boxing/Unboxing" "volatile ÌÇ§ÏõåÎìú"
          )

          # ÏãúÏûë ÎÇ†Ïßú ÏÑ§Ï†ï (Ïò§ÎäòÎ∂ÄÌÑ∞ Î°úÌÖåÏù¥ÏÖò ÏãúÏûëÌïòÎèÑÎ°ù ÏÑ§Ï†ï)
          # ÎßåÏïΩ ÌäπÏ†ï ÏàúÏÑúÎåÄÎ°ú ÌïòÍ≥† Ïã∂Îã§Î©¥ ÎÇ†ÏßúÎ•º Í≥†Ï†ïÌïòÏÑ∏Ïöî. (Ïòà: 2024-01-01)
          START_DATE="2024-12-11"
          START_SECONDS=$(date -d "$START_DATE" +%s)
          TODAY_SECONDS=$(date +%s)
          
          # Ï£ºÎßê Ï†úÏô∏ Î°úÏßÅ ÏóÜÏù¥ Îã®Ïàú ÏùºÏûê Í≤ΩÍ≥ºÎ°ú Í≥ÑÏÇ∞ÌïòÎ†§Î©¥ ÏïÑÎûò ÏÇ¨Ïö©
          DAYS_SINCE_START=$(( (TODAY_SECONDS - START_SECONDS) / 86400 ))
          
          # Î∞∞Ïó¥ ÌÅ¨Í∏∞Î°ú ÎÇòÎàà ÎÇòÎ®∏ÏßÄÎ°ú Ïù∏Îç±Ïä§ Í≤∞Ï†ï
          TOPIC_INDEX=$(( DAYS_SINCE_START % ${#TOPICS[@]} ))
          TODAY_TOPIC=${TOPICS[$TOPIC_INDEX]}

          # Ïù¥Ïäà Ï†úÎ™© & Î≥∏Î¨∏ ÏÉùÏÑ±
          echo "ISSUE_TITLE=[$(date +'%Y-%m-%d')] Ïò§ÎäòÏùò 1ÏãúÍ∞Ñ Í≥µÎ∂Ä: $TODAY_TOPIC" >> "$GITHUB_ENV"

          {
            echo "ISSUE_BODY<<EOF"
            echo "## üéØ Ïò§ÎäòÏùò Í≥µÎ∂Ä Ï£ºÏ†ú"
            echo "# **$TODAY_TOPIC**"
            echo ""
            echo "---"
            echo ""
            echo "## üí° ÌïµÏã¨ Í∞úÎÖê (Definition)"
            echo "> Ìïú Ï§Ñ ÏöîÏïΩ: "
            echo ""
            echo "- "
            echo ""
            echo "## ‚öôÔ∏è ÎèôÏûë ÏõêÎ¶¨ / Íµ¨Ï°∞ (Mechanism)"
            echo "\`\`\`java"
            echo "// ÌïÑÏöî Ïãú ÏΩîÎìú ÏòàÏ†ú ÏûëÏÑ±"
            echo "\`\`\`"
            echo ""
            echo "## üÜö Ïû•Îã®Ï†ê / ÎπÑÍµê (Pros & Cons)"
            echo "- Ïû•Ï†ê: "
            echo "- Îã®Ï†ê: "
            echo "- ÎπÑÍµê ÎåÄÏÉÅ: "
            echo ""
            echo "---"
            echo ""
            echo "## üîó Ï∞∏Í≥† ÏûêÎ£å (References)"
            echo "- [ ] Í≥µÏãù Î¨∏ÏÑú ÌôïÏù∏"
            echo "- [ ] Î∏îÎ°úÍ∑∏ Ï†ïÎ¶¨ ÏôÑÎ£å"
            echo "EOF"
          } >> "$GITHUB_ENV"

      - name: 'Create GitHub Issue'
        uses: actions/github-script@v7
        env:
          TITLE: ${{ env.ISSUE_TITLE }}
          BODY: ${{ env.ISSUE_BODY }}
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: process.env.TITLE,
              body: process.env.BODY,
              labels: ['CSÍ≥µÎ∂Ä', 'TIL', 'ÏûêÎèô ÏÉùÏÑ±']
            })
