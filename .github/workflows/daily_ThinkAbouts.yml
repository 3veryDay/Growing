name: 'ðŸ—“ï¸ ì˜¤ëŠ˜ì˜ 1ì‹œê°„ ê³µë¶€ ì£¼ì œ ìƒì„±'

on:
  # í•œêµ­ ì‹œê°„(KST) ê¸°ì¤€ ì›”~ê¸ˆ ìžì •ì— ì‹¤í–‰ (UTC 15:00)
  schedule:
    - cron: '0 15 * * 1-5'

  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ì¶”ê°€
  workflow_dispatch:

jobs:
  create_daily_study:
    name: Create Daily Study Issue
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: 'Set KST Timezone'
        uses: szenius/set-timezone@v2.0
        with:
          timezoneLinux: 'Asia/Seoul'
      
      - name: 'Generate Issue Content'
        id: issue_content
        run: |
          # ðŸ“š ê³µë¶€í•  ì£¼ì œ ë°°ì—´ (ë¬´ìž‘ìœ„ ì„žìŒ ì™„ë£Œ)
          TOPICS=(
            "Redis í™œìš©" "SOP & CORS" "@Transactional ë™ìž‘ ì›ë¦¬" "B-Treeì™€ B+Tree (Index)" "JVM ë©”ëª¨ë¦¬ êµ¬ì¡° (Stack, Heap, Method)"
            "Spring MVC êµ¬ì¡°" "ì¸ë±ìŠ¤ (Clustered vs Non-clustered)" "Java Stream API" "JWT" "ëŒ€ì¹­í‚¤ vs ë¹„ëŒ€ì¹­í‚¤"
            "Spring Security êµ¬ì¡°" "GC (Garbage Collection) ì•Œê³ ë¦¬ì¦˜" "DB Lock (Optimistic vs Pessimistic)" "WebFlux" "OAuth"
            "JPA Persistent Context (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)" "ë©€í‹°ìŠ¤ë ˆë“œì™€ ìŠ¤ë ˆë“œí’€" "íŠ¸ëžœìž­ì…˜ê³¼ ACID" "IOC (Inversion of Control)" "NoSQL"
            "ì ‘ê·¼ ì œì–´ìž(Access Modifier)ì˜ ë™ìž‘ ë°©ì‹" "Spring Data JDBC" "Replication" "Lambda Expression" "XSS"
            "QueryDSL" "Connection Pool" "Filter vs Interceptor" "String, hashCode(), equals()" "JOINì˜ ì¢…ë¥˜ì™€ ì›ë¦¬"
            "AOP (Aspect Oriented Programming)" "WebClient" "InnoDB ìŠ¤í† ë¦¬ì§€ ì—”ì§„" "Optional í™œìš©" "Flyway (DB ë§ˆì´ê·¸ë ˆì´ì…˜)"
            "MySQLì˜ ì‹¤í–‰ê³„íš" "Thread Safe ìžë£Œêµ¬ì¡° (ConcurrentHashMap ë“±)" "Dynamic Proxy vs CGLIB" "Caching Strategy" "Generic"
            "Spring Bean ìƒëª…ì£¼ê¸°" "Covering Index" "Jigsaw (Java Module System)" "Map êµ¬í˜„ì²´ ë¹„êµ (HashMap, TreeMap, LinkedHashMap)" "ì •ê·œí™”(Normalization)"
            "JUnit í…ŒìŠ¤íŠ¸" "JCF (Java Collections Framework)" "Actuator" "Sequence" "Process vs Thread"
            "Web Polling (Long/Short)" "Comparable vs Comparator" "Spring Cloud" "static í‚¤ì›Œë“œ" "Trigger"
            "PSA (Portable Service Abstraction)" "Serialization (ì§ë ¬í™”)" "Immutability (ë¶ˆë³€ì„±)" "ë‚´ìž¥ Tomcat" "Java ë²„ì „ë³„ íŠ¹ì§• (8, 11, 17, 21)"
            "Auto Configure (ìžë™ ì„¤ì •)" "Bulk Insert" "Functional Interface" "Java ì˜ˆì™¸ ì²˜ë¦¬ ê³„ì¸µ (Checked vs Unchecked)" "Logger (SLF4J/Logback)"
            "Runnable vs Callable" "Servlet" "Spring ì˜ˆì™¸ì²˜ë¦¬ (ExceptionHandler)" "Cache Locality" "Profile (@Profile)"
            "Reflection API" "Server Sent Event (SSE)" "ë™ê¸°(Synchronous) vs ë¹„ë™ê¸°(Asynchronous)" "ê¸°ë³¸í‚¤ ìƒì„± ì „ëžµ (Identity/Sequence/Table)" "Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬"
            "ì–•ì€ ë³µì‚¬ vs ê¹Šì€ ë³µì‚¬" "Annotation Processor" "Regular Expression (ì •ê·œí‘œí˜„ì‹)" "Build Tool (Gradle vs Maven)" "javacì™€ ì»´íŒŒì¼ ê³¼ì •"
            "null ì²˜ë¦¬" "Self Relationship" "Swagger (SpringDoc)" "final í‚¤ì›Œë“œ" "JMX (Java Management Extensions)"
            "Boxing/Unboxing" "volatile í‚¤ì›Œë“œ" "Java Record (Java 14+)" "ì¸ì¦(Authentication) vs ì¸ê°€(Authorization)"
          )

          # ì‹œìž‘ ë‚ ì§œ ì„¤ì • (ì˜¤ëŠ˜ë¶€í„° ë¡œí…Œì´ì…˜ ì‹œìž‘)
          START_DATE="2024-12-11"
          START_SECONDS=$(date -d "$START_DATE" +%s)
          TODAY_SECONDS=$(date +%s)
          
          # ê²½ê³¼ ì¼ìˆ˜ ê³„ì‚°
          DAYS_SINCE_START=$(( (TODAY_SECONDS - START_SECONDS) / 86400 ))
          
          # ë°°ì—´ í¬ê¸°ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ë¡œ ì˜¤ëŠ˜ì˜ ì£¼ì œ ì¸ë±ìŠ¤ ê²°ì •
          TOPIC_INDEX=$(( DAYS_SINCE_START % ${#TOPICS[@]} ))
          TODAY_TOPIC=${TOPICS[$TOPIC_INDEX]}

          # ì´ìŠˆ ì œëª© & ë³¸ë¬¸ ìƒì„±
          echo "ISSUE_TITLE=[$(date +'%Y-%m-%d')] ì˜¤ëŠ˜ì˜ 1ì‹œê°„ ê³µë¶€: $TODAY_TOPIC" >> "$GITHUB_ENV"

          {
            echo "ISSUE_BODY<<EOF"
            echo "## ðŸŽ¯ ì˜¤ëŠ˜ì˜ ê³µë¶€ ì£¼ì œ"
            echo "# **$TODAY_TOPIC**"
            echo ""
            echo "---"
            echo ""
            echo "## ðŸ’¡ í•µì‹¬ ê°œë… (Definition)"
            echo "> í•œ ì¤„ ìš”ì•½: "
            echo ""
            echo "- "
            echo ""
            echo "## âš™ï¸ ë™ìž‘ ì›ë¦¬ / êµ¬ì¡° (Mechanism)"
            echo "\`\`\`java"
            echo "// í•„ìš” ì‹œ ì½”ë“œ ì˜ˆì œ ìž‘ì„±"
            echo "\`\`\`"
            echo ""
            echo "## ðŸ†š ìž¥ë‹¨ì  / ë¹„êµ (Pros & Cons)"
            echo "- ìž¥ì : "
            echo "- ë‹¨ì : "
            echo "- ë¹„êµ ëŒ€ìƒ: "
            echo ""
            echo "---"
            echo ""
            echo "## ðŸ”— ì°¸ê³  ìžë£Œ (References)"
            echo "- [ ] ê³µì‹ ë¬¸ì„œ í™•ì¸"
            echo "- [ ] ë¸”ë¡œê·¸ ì •ë¦¬ ì™„ë£Œ"
            echo "EOF"
          } >> "$GITHUB_ENV"

      - name: 'Create GitHub Issue'
        uses: actions/github-script@v7
        env:
          TITLE: ${{ env.ISSUE_TITLE }}
          BODY: ${{ env.ISSUE_BODY }}
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: process.env.TITLE,
              body: process.env.BODY,
              labels: ['CSê³µë¶€', 'TIL']
            })
